<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Capacidad de Mesas con Acompa√±antes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .mesa-card {
            border: 2px solid #ddd;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .mesa-full {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .mesa-occupied {
            border-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test: Capacidad de Mesas con Acompa√±antes</h1>
        <p>Este test verifica que la asignaci√≥n de mesas considere correctamente el n√∫mero total de personas.</p>
        
        <div class="test-container">
            <h3>1. Crear Datos de Prueba</h3>
            <button onclick="crearDatosPrueba()">Crear Datos de Prueba</button>
            <div id="resultado1"></div>
        </div>

        <div class="test-container">
            <h3>2. Simular Asignaci√≥n con Acompa√±antes</h3>
            <button onclick="simularAsignacion()">Simular Asignaci√≥n</button>
            <div id="resultado2"></div>
        </div>

        <div class="test-container">
            <h3>3. Verificar Capacidad de Mesa</h3>
            <button onclick="verificarCapacidad()">Verificar Capacidad</button>
            <div id="resultado3"></div>
        </div>

        <div class="test-container">
            <h3>4. Estado de las Mesas</h3>
            <button onclick="mostrarEstadoMesas()">Mostrar Estado de Mesas</button>
            <div id="resultado4"></div>
        </div>
    </div>

    <script>
        // Simular el AdminPanel y sus funciones
        class SimulatedAdminPanel {
            constructor() {
                this.tables = [];
                this.guests = [];
                this.initializeTables();
            }

            initializeTables() {
                this.tables = [];
                for (let i = 1; i <= 3; i++) {
                    this.tables.push({
                        number: i,
                        guests: [],
                        capacity: 10
                    });
                }
            }

            getTableTotalGuests(table) {
                return table.guests.reduce((total, group) => total + group.total, 0);
            }

            updateTableSelect() {
                const availableTables = this.tables.filter(table => {
                    const totalGuests = this.getTableTotalGuests(table);
                    return totalGuests < table.capacity;
                });
                
                return availableTables.map(table => {
                    const totalGuests = this.getTableTotalGuests(table);
                    return `Mesa ${table.number} (${totalGuests}/${table.capacity})`;
                });
            }

            assignGuestToTable(guest, tableNumber) {
                const table = this.tables.find(t => t.number === tableNumber);
                if (!table) return { success: false, error: 'Mesa no encontrada' };

                const totalGuests = parseInt(guest.num_acompanantes) + 1;
                const currentTableGuests = this.getTableTotalGuests(table);
                
                if (currentTableGuests + totalGuests > table.capacity) {
                    return { 
                        success: false, 
                        error: `No hay suficiente espacio. Capacidad: ${table.capacity}, actuales: ${currentTableGuests}, requeridos: ${totalGuests}`
                    };
                }

                table.guests.push({
                    id: guest.id,
                    nombre: guest.nombre,
                    acompa√±antes: parseInt(guest.num_acompanantes),
                    total: totalGuests
                });

                return { success: true, message: `Asignado ${totalGuests} personas` };
            }
        }

        const adminPanel = new SimulatedAdminPanel();

        function crearDatosPrueba() {
            const resultado = document.getElementById('resultado1');
            
            // Crear invitados con diferentes n√∫meros de acompa√±antes
            adminPanel.guests = [
                { id: '1', nombre: 'Mar√≠a Gonz√°lez', num_acompanantes: '2' }, // 3 personas total
                { id: '2', nombre: 'Carlos Rodr√≠guez', num_acompanantes: '1' }, // 2 personas total
                { id: '3', nombre: 'Ana Mart√≠nez', num_acompanantes: '0' } // 1 persona
            ];

            resultado.innerHTML = `
                <div class="success">
                    ‚úÖ Datos de prueba creados:<br>
                    ‚Ä¢ <strong>${adminPanel.guests[0].nombre}</strong> + ${adminPanel.guests[0].num_acompanantes} acompa√±antes = <strong>3 personas total</strong><br>
                    ‚Ä¢ <strong>${adminPanel.guests[1].nombre}</strong> + ${adminPanel.guests[1].num_acompanantes} acompa√±ante = <strong>2 personas total</strong><br>
                    ‚Ä¢ <strong>${adminPanel.guests[2].nombre}</strong> + ${adminPanel.guests[2].num_acompanantes} acompa√±ante = <strong>1 persona</strong>
                </div>
            `;
        }

        function simularAsignacion() {
            const resultado = document.getElementById('resultado2');
            let output = '';
            
            // Asignar el primer invitado (3 personas) a la mesa 1
            const guest1 = adminPanel.guests[0];
            const result1 = adminPanel.assignGuestToTable(guest1, 1);
            output += `‚Ä¢ <strong>${guest1.nombre}</strong> a Mesa 1: ${result1.success ? '‚úÖ ' + result1.message : '‚ùå ' + result1.error}<br>`;
            
            // Asignar el segundo invitado (2 personas) a la mesa 1
            const guest2 = adminPanel.guests[1];
            const result2 = adminPanel.assignGuestToTable(guest2, 1);
            output += `‚Ä¢ <strong>${guest2.nombre}</strong> a Mesa 1: ${result2.success ? '‚úÖ ' + result2.message : '‚ùå ' + result2.error}<br>`;
            
            // Asignar el tercer invitado (1 persona) a la mesa 1
            const guest3 = adminPanel.guests[2];
            const result3 = adminPanel.assignGuestToTable(guest3, 1);
            output += `‚Ä¢ <strong>${guest3.nombre}</strong> a Mesa 1: ${result3.success ? '‚úÖ ' + result3.message : '‚ùå ' + result3.error}<br>`;

            resultado.innerHTML = `
                <div class="info">
                    <strong>Resultados de asignaci√≥n:</strong><br>
                    ${output}
                </div>
            `;
        }

        function verificarCapacidad() {
            const resultado = document.getElementById('resultado3');
            const mesa1 = adminPanel.tables[0]; // Mesa 1
            const totalGuests = adminPanel.getTableTotalGuests(mesa1);
            
            resultado.innerHTML = `
                <div class="info">
                    <strong>Mesa 1 Estado:</strong><br>
                    ‚Ä¢ Grupos asignados: <strong>${mesa1.guests.length}</strong><br>
                    ‚Ä¢ Total de personas: <strong>${totalGuests}</strong><br>
                    ‚Ä¢ Capacidad m√°xima: <strong>${mesa1.capacity}</strong><br>
                    ‚Ä¢ Espacio disponible: <strong>${mesa1.capacity - totalGuests}</strong><br>
                    ${totalGuests >= mesa1.capacity ? '<div class="error">‚ùå Mesa COMPLETA</div>' : '<div class="success">‚úÖ Mesa tiene espacio</div>'}
                </div>
            `;
        }

        function mostrarEstadoMesas() {
            const resultado = document.getElementById('resultado4');
            let output = '';
            
            adminPanel.tables.forEach(table => {
                const totalGuests = adminPanel.getTableTotalGuests(table);
                const status = totalGuests >= table.capacity ? 'full' : (totalGuests > 0 ? 'occupied' : '');
                const statusText = totalGuests >= table.capacity ? 'FULL' : (totalGuests > 0 ? 'OCCUPIED' : 'EMPTY');
                
                output += `
                    <div class="mesa-card mesa-${status}">
                        <strong>Mesa ${table.number} - ${statusText}</strong><br>
                        Capacidad: ${totalGuests}/${table.capacity} personas<br>
                        Grupos: ${table.guests.length}<br>
                        ${table.guests.map(g => `‚Ä¢ ${g.nombre} (${g.total} personas)`).join('<br>') || 'Sin asignar'}
                    </div>
                `;
            });
            
            resultado.innerHTML = `
                <div class="info">
                    <strong>Estado de todas las mesas:</strong><br>
                    ${output}
                </div>
            `;
        }

        // Inicializar autom√°ticamente
        window.addEventListener('load', () => {
            console.log('üß™ Test de capacidad de mesas cargado');
        });
    </script>
</body>
</html>